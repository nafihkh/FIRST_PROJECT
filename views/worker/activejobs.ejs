<!DOCTYPE html>
<html lang="en">

<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face {
            font-family: "Inter";
            src: url("/fonts/Inter-Regular.ttf");
        }

        body {
            font-family: "Inter";
            background-color: #0f172a;
            color: white;
        }

        .card {
            background: #1e293b;
            border: none;
            border-radius: 15px;
        }

        .cart-img {
            width: 358px;
            height: 196px;
        }
    </style>
</head>

<body>

    <%- include('../partials/header') %>

        <div class="d-flex">

            <%- include('../partials/sidebar') %>


                <div class="flex-grow-1 p-4">
                    <h3 class="fw-bold mb-4">Active Jobs</h3>
                    <div id="itemcontainer">>
                        <div class="row align-items-center rounded-3"
                            style="background: linear-gradient(-70deg, #222426FF 0%, #2A2C2FFF 100%); border-left: 4px solid #636AE8;">
                            <img class="cart-img rounded-start-3 col-md-5 m-0 p-0" src="/images/task4.png" alt="">
                            <div class="col-md-5">
                                <h6 class="mb-0 pb-0 fw-semibold" style="color: #fff; font-size: 20px;">Need a full
                                    stack
                                    developer</h6>
                                <label class="mt-0 pt-0 mb-1" style="color: #565e6c; font-size: 14px;">by
                                    shafipuvattuparambil</label>
                                <p class="mt-0 pt-0 mb-2" style="color: #fff; font-size: 14px;">need a full stack
                                    developer for compleat my project</p>
                                <div class="row align-items-center mb-2 mt-5">

                                    <div class="col-md-4">
                                        <h5 class="fw-semibold my-auto mb-2" style="font-size: 14px; color:#fff;">Budget
                                        </h5>
                                        <label class="mt-0 pt-0 mb-1 fw-semibold"
                                            style="color: #4ade80; font-size: 14px;">$2,850</label>
                                    </div>
                                    <div class="col-md-4">
                                        <h5 class="fw-semibold my-auto mb-1" style="font-size: 14px; color:#fff;">Dead
                                            line</h5>
                                        <label class="mt-0 pt-0 mb-1 fw-semibold"
                                            style="color: #fff; font-size: 14px;">Dec 15, 2025</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 text-center mx-auto">
                                <button onclick="window.location.href='/worker/activejobs/viewmore'"
                                    class="btn  rounded-2 btn-secondary w-100">View More</button>
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    async function loadActiveJobs() {
                        try {
                            const res = await fetch("/worker/api/activejobs"); // this calls your controller
                            if (!res.ok) throw new Error("Failed to fetch tasks");

                            const tasks = await res.json();
                            const container = document.getElementById("itemcontainer");
                            container.innerHTML = ""; // clear old content

                            tasks.forEach(task => {
                                const div = document.createElement("div");
                                div.className = "row align-items-center rounded-3 mb-3";
                                div.style = "background: linear-gradient(-70deg, #222426FF 0%, #2A2C2FFF 100%); border-left: 4px solid #636AE8;";

                                div.innerHTML = `
                                    <img class="cart-img rounded-start-3 col-md-5 m-0 p-0" src="${task.photo || '/images/task4.png'}" alt="">
                                    <div class="col-md-5">
                                        <h6 class="mb-0 pb-0 fw-semibold" style="color: #fff; font-size: 20px;">${task.title || 'No Title'}</h6>
                                        <label class="mt-0 pt-0 mb-1" style="color: #565e6c; font-size: 14px;">by ${task.user_id?.username || 'Unknown'}</label>
                                        <p class="mt-0 pt-0 mb-2" style="color: #fff; font-size: 14px;">${task.description || ''}</p>
                                        <div class="row align-items-center mb-2 mt-5">
                                            <div class="col-md-4">
                                                <h5 class="fw-semibold my-auto mb-2" style="font-size: 14px; color:#fff;">Budget</h5>
                                                <label class="mt-0 pt-0 mb-1 fw-semibold" style="color: #4ade80; font-size: 14px;">$${task.amount || 0}</label>
                                            </div>
                                            <div class="col-md-4">
                                                <h5 class="fw-semibold my-auto mb-1" style="font-size: 14px; color:#fff;">Deadline</h5>
                                                <label class="mt-0 pt-0 mb-1 fw-semibold" style="color: #fff; font-size: 14px;">${task.deadline || 'N/A'}</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 text-center mx-auto">
                                        <button onclick="window.location.href='/worker/activejobs/viewmore/${task._id}'" class="btn rounded-2 btn-secondary w-100">View More</button>
                                    </div>
                                `;

                                container.appendChild(div);
                            });
                        } catch (err) {
                            console.error(err);
                        }
                    }

                    // Load tasks when DOM is ready
                    document.addEventListener("DOMContentLoaded", loadActiveJobs);


                </script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>


</html>