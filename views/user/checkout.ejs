<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    @font-face {
      font-family: "Inter";
      src: url("/fonts/Inter-Regular.ttf");
    }

    body {
      font-family: "Inter";
      background-color: #0f172a;
      color: white;
    }

    .topbar {
      width: 100%;
      border-bottom: 1px solid #777777;
    }

    .topbar a {
      font-size: 14px;
      color: #bcc1ca;
      margin-right: 10px;
    }

    .active {
      border-bottom: 2px solid #2450b1;
      padding-bottom: 3px;
    }

    .card {
      background: #1e293b;
      border: none;
      border-radius: 15px;
    }

    .paid {
      background: #10B98133;
      color: #10b981;
      font-size: 12px;
    }

    .unpaid {
      background: #ff000033;
      color: #db0000;
      font-size: 12px;
    }

    .custom-table-wrapper {
      background-color: #171c26;
      color: #bdc1ca;
      border-radius: 19px;
      overflow: hidden;
      font-size: 14px;
    }

    .custom-table {
      background: transparent !important;
      margin-bottom: 0;
      border-collapse: separate;
      border-spacing: 0;
    }

    .custom-table thead th {
      color: #bdc1ca;
      background: #262a33;
      border-bottom: 1px solid #2f343d;
      font-weight: 600;
      padding: 16px 18px;
    }

    .custom-table tbody tr {
      background: transparent;
      border-bottom: 1px solid #2f343d;
    }

    .custom-table tbody tr:last-child {
      border-bottom: none;
    }

    .custom-table tbody td {
      color: #f3f4f6;

      background: transparent !important;
      vertical-align: middle;
      padding: 16px 18px;
    }

    .custom-table tbody tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }
  </style>
</head>

<body>
  <%- include('../partials/header') %>

    <div class="d-flex">
      <%- include('../partials/sidebar') %>

        <div class="container">
          <h2>Processing Your Payment...</h2>
          <p>Invoice ID: <%= invoice._id %>
          </p>
          <p>Total Amount: ₹<%= invoice.total_amount %>
          </p>
        </div>
    </div>

    <!-- <button id="payBtn" class="btn btn-primary">Pay Now</button> -->

    <script>
      window.onload = async function () {
    console.log("Pay button clicked!");

    const res = await fetch("/user/create-order/<%= invoice._id %>/pay");
    const data = await res.json();
    console.log("Received Order Data:", data);

    if (!data.success) {
      alert("Order creation failed: " + data.message);
      return;
    }

    const options = {
      key: data.key,
      amount: data.amount,
      currency: "INR",
      name: "Your Platform Name",
      description: "Invoice Payment",
      order_id: data.order_id,
      handler: async function (response) {
        // ✅ Send to backend for verification
        const verifyRes = await fetch("/user/verify-payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature,
            invoiceId: "<%= invoice._id %>"
          }),
        });

        const result = await verifyRes.json();
        if (result.success) {
          alert("Invoice Paid Successfully!");
          window.location.href = "/user/payments/invoice";
        } else {
          alert("Verification Failed!");
        }
      },
    };

    const rzp = new Razorpay(options);
    rzp.open();
      }
    </script>
 


</body>

</html>